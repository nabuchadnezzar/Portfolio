function getPasteEvent(){var e=document.createElement("input");return e.setAttribute("onpaste",""),"function"==typeof e.onpaste?"paste":"input"}var caretTimeoutId,pasteEventName=getPasteEvent()+".mask",ua=navigator.userAgent,iPhone=/iphone/i.test(ua),android=/android/i.test(ua);$.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},$.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&((n=this.createTextRange()).collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(e,t){var n,a,r,i,o;return!e&&this.length>0?$(this[0]).data($.mask.dataName)():(t=$.extend({placeholder:$.mask.placeholder,completed:null},t),n=$.mask.definitions,a=[],r=o=e.length,i=null,$.each(e.split(""),function(e,t){"?"==t?(o--,r=e):n[t]?(a.push(new RegExp(n[t])),null===i&&(i=a.length-1)):a.push(null)}),this.trigger("unmask").each(function(){var c=$(this),l=$.map(e.split(""),function(e,a){if("?"!=e)return n[e]?t.placeholder:e}),s=c.val();function u(e){for(;++e<o&&!a[e];);return e}function d(e,n){var r,s;if(!(e<0)){for(r=e,s=u(n);r<o;r++)if(a[r]){if(!(s<o&&a[r].test(l[s])))break;l[r]=l[s],l[s]=t.placeholder,s=u(s)}h(),c.caret(Math.max(i,e))}}function f(e,n){var r;for(r=e;r<n&&r<o;r++)a[r]&&(l[r]=t.placeholder)}function h(){c.val(l.join(""))}function m(e){var n,s,u=c.val(),d=-1;for(n=0,pos=0;n<o;n++)if(a[n]){for(l[n]=t.placeholder;pos++<u.length;)if(s=u.charAt(pos-1),a[n].test(s)){l[n]=s,d=n;break}if(pos>u.length)break}else l[n]===u.charAt(pos)&&n!==r&&(pos++,d=n);return e?h():d+1<r?(c.val(""),f(0,o)):(h(),c.val(c.val().substring(0,d+1))),r?n:i}c.data($.mask.dataName,function(){return $.map(l,function(e,n){return a[n]&&e!=t.placeholder?e:null}).join("")}),c.attr("readonly")||c.one("unmask",function(){c.unbind(".mask").removeData($.mask.dataName)}).bind("focus.mask",function(){var t;clearTimeout(caretTimeoutId),s=c.val(),t=m(),caretTimeoutId=setTimeout(function(){h(),t==e.length?c.caret(0,t):c.caret(t)},10)}).bind("blur.mask",function(){m(),c.val()!=s&&c.change()}).bind("keydown.mask",function(e){var t,n,r,i=e.which;8===i||46===i||iPhone&&127===i?(n=(t=c.caret()).begin,(r=t.end)-n==0&&(n=46!==i?function(e){for(;--e>=0&&!a[e];);return e}(n):r=u(n-1),r=46===i?u(r):r),f(n,r),d(n,r-1),e.preventDefault()):27==i&&(c.val(s),c.caret(0,m()),e.preventDefault())}).bind("keypress.mask",function(e){var n,r,i,s=e.which,m=c.caret();e.ctrlKey||e.altKey||e.metaKey||s<32||s&&(m.end-m.begin!=0&&(f(m.begin,m.end),d(m.begin,m.end-1)),(n=u(m.begin-1))<o&&(r=String.fromCharCode(s),a[n].test(r)&&(function(e){var n,r,i,c;for(n=e,r=t.placeholder;n<o;n++)if(a[n]){if(i=u(n),c=l[n],l[n]=r,!(i<o&&a[i].test(c)))break;r=c}}(n),l[n]=r,h(),i=u(n),android?setTimeout($.proxy($.fn.caret,c,i),0):c.caret(i),t.completed&&i>=o&&t.completed.call(c))),e.preventDefault())}).bind(pasteEventName,function(){setTimeout(function(){var e=m(!0);c.caret(e),t.completed&&e==c.val().length&&t.completed.call(c)},0)}),m()}))}});